{% version "3.x" %}
The API integrations are defined in the Amelia V3 administration pages. Click the Integrations Home link on the left side then click Integration Home to display the home page. To create an integration, at least configure one Host data and one or more Flows.
An integration flow also can be created with an integration template, as described at the bottom of this page.
# Configure a Host
The first step is to configure a Host to make Amelia aware of one or more hosts that will run integration services. In many cases, the localhost integration service will run on the same host as Amelia V3 with the administrative port listening on port 4635. However, this is not automatically set.
From the Integrations workspace, click the Hosts link near the top of the page, then click the blue plus button at the top right to open a New Integration Service form.
To continue to configure an integration flow API or similar API, configure the localhost with this data. Click the Save icon at the top right of the form to save the host definition.
![](attachments/11939847/11939852.png)
Figure. Integration Host Form
Table. Integration Host Elements

| Host Element | Example | Description |
| ----|----|----|
| Name | localhost | A readable name for the host |
| Host | localhost | The FQDN of the host, as it can be reached from the Amelia V3 Instance itself. |
| Port | 4635 | The port upon which the;gRPC administrative service is running |
| Cluster |  | A host can optionally belong to a Cluster, defined elsewhere in the integration administration tools.; Clusters are for bulk operations so that a Flow can be deployed to or undeployed from multiple hosts at one time. |
| Description | Default localhost | Brief information about the Integration Host |
| Deleted/Disabled |  | A deleted/disabled host still exists in the system but is not eligible for any deployments. |
| Certificate |  | Visible only for an existing host record. Integration services declare themselves to Amelia on startup of the integration service. Services create their own certificates and send a public certificate to Amelia. Click the Certificate button to display a public certificate for a host. |
| Delete Certificate |  | Visible only for an existing host record. Click the Delete Certificate button to delete the public certificate generated by a service. Rebooting the integration service will cause the service to create their own certificates and send a new public certificate to Amelia. |

# Configure a Flow
To create a flow, click the Flows link at the top left of the Integration Home page. Click the blue plus sign at the top right of the page to display the Integration Service workspace. This workspace includes a form on the left side and designer tool on the right.
Complete the flow edit form, on the left side, as shown below to create a sample flow to pull data from Yahoo's weather API. Instructions below describe how to code the integration and call a flow from a BPN process model.
> [!warning]  
>
> Names for integration flows must be unique within each domain. Integration flows also are accessible to parent and child domains.
>
> The closest integration flow has the highest priority in cases where a parent or child domain has the same name for a flow. For example, if the global, parent, and current domains each have an integration flow named Weather, a BPN in the current domain will call the Weather flow from the current domain. If there is no Weather flow in the current domain, the BPN in the current domain would call the Weather flow defined in the parent domain.

![](attachments/11939847/11939851.jpg)
Figure. Configure the Integration Flow
Table. Integration Flow Form Elements

| Flow Element | Example | Description |
| ----|----|----|
| Name | YahooWeather | A readable name for the flow, which can be changed after creation. No spaces between words are allowed. Must be unique within the current selected domain. |
| Code | yahoo_weather | An alternate key for the flow, immutable after creation.; This value must be unique within the current selected domain. Code names also cannot be edited once created. |
| Domain |  | Every flow must belong to one Amelia Domain |
| Description | Pull weather data from Yahoo | Brief information about the Integration Flow |
| Assets |  | Binary elements that should be included in a flow.; These assets will be included in the jar file assembled for deployment. Click the plus sign to the right of the Assets dropdown list to add assets to a specific domain. |
| Property | {{password}} | Create one or more properties to handle data, for example, usernames and passwords. Properties can be encrypted or plain text. Sensitive data should always be defined as an encrypted property, not passed any other way. |

## Configure Flows with Stencils and Designer View
The Flows workspace includes a visual design tool to create integration flows with configurable drag and drop stencils.
The default Flows workspace includes a Route nested in an Integration Context. The route includes two stencils, one to start the flow (*URL From*) and one to receive any data collected from the route (*URL To*).
This demonstration adds two stencils to the default route, a *URL To* stencil followed by a *Body* stencil. The XML output can be examined at this Yahoo Weather URL: <https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(select%20woeid%20from%20geo.places(1)%20where%20text%3D%22nome%2C%20ak%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=>
![](attachments/11939847/11939850.png)
Figure. Default Flows Workspace with Nested Route in an Integration Context
1.  Click to select the default *URL To* stencil in the Route and drag the stencil to the far right. This will make room to drop other stencils while preserving the default code included in the stencil.
2.  Select a *URL To* stencil from the Stencil column in the designer then drag it between the two default stencils. Drop it near the default *URL From* stencil.
3.  With the new *URL To* stencil selected, copy/paste this API URL in the Properties field on the right side of the workspace:
    ``` text
    https4://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(select%20woeid%20from%20geo.places(1)%20where%20text%3D%22nome%2C%20ak%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=
    ```
    > [!warning]  
    >
    > Note the use of https4 is not a typographical error. In the Camel language, https4 is a language-specific syntax to refer to the Apache https4 client software. For other projects, use http4 or https4 as appropriate.
    ![](https://docs.ipsoft.com/download/attachments/11935159/image2018-5-4_15-35-43.png)  
    Figure. Drag Default *URL To* Stencil to Right  
4.  Select the arrow that connects the default *URL From* stencil to the default *URL To* stencil. The arrow head turns orange. Drag the arrow back until the new *URL To* stencil is outlined in orange. This connects the default *URL From* stencil to the new *URL To* stencil. If needed, delete the original arrow and click the curved connector arrow icon to the right of the original *URL From* stencil and drag the icon to the new *URL To* stencil with the Yahoo Weather URL in its Properties field.
    ![](attachments/11939847/11939856.jpg)
    Figure. Select the Arrow Connecting Default Stencils
5.  Select a *Body* stencil from the Stencil column in the designer then drag it between the new *URL To* stencil and the original *URL To* stencil.
6.  Select the new *Body* stencil and confirm the properties Type is java.lang.String.
    ![](attachments/11939847/11939857.jpg)
    Figure. Drag *Body* Stencil between *URL To* Stencils
7.  The next step is to connect isolated stencils in the route. Select the curved connector arrow on the right edge of the new *URL To* stencil. It turns red. Click the red arrow and drag to connect to the new *Body* stencil until it is outlined in orange.
    Click the new *Body* stencil, select the curved connector arrow on the right edge then drag to connect to the default *URL To* stencil until it is outlined in orange.
    ![](attachments/11939847/11939858.jpg)
    Figure. Connect Stencils with Connect Arrow
8.  With default and new stencils connected in sequence, select the default *URL To* stencil and update the variable values for the *URL To* moveToOutboundVariables property. The *body* variable is the JSON output Yahoo returns. Amelia converts the data into a Groovy LazyMap object.  
    > [!warning]  
    >
    > \_body\_ in this code is variable notation unique to Amelia, not a typo.
    ``` text
    bean:varpop?method=moveToOutboundVariables('_body_')
    ```
    ![](attachments/11939847/11939859.jpg)
    Figure. Update Default *URL To* Value for moveToOutboundVariables
9.  Click the Folder icon at the top left of the Flows workspace to display the Save icon and flow details. Click the Save icon to save the flow.
## Configure Flows with Code and Source View
Integration flows also can be created with Camel code using the Flow workspace. The Designer View automatically updates to translate the code into configured stencils and connectors.
In the Flows designer, click Source View at the bottom right and paste in this code to define a Camel flow for Yahoo's weather API:
> [!warning]  
>
> Camel code must have a camel:from statement with id set to mainRouteStart and the uri set to direct:start. Amelia looks for direct:start to begin the integration flow.

``` bash
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camel="http://camel.apache.org/schema/spring" xsi:schemaLocation="http://www.springframework.org/schema/beans
 http://www.springframework.org/schema/beans/spring-beans-4.2.xsd
 http://camel.apache.org/schema/spring
 http://camel.apache.org/schema/spring/camel-spring.xsd
">
    <!-- add a comment -->
    <camel:camelContext id="mainContext">
        <camel:route id="route1">
            <camel:description layoutX="40" layoutY="200" layoutWidth="560" layoutHeight="340"/>
            <camel:from id="mainRouteStart" uri="direct:start">
                <camel:description layoutX="50" layoutY="250" layoutWidth="120" layoutHeight="120"/>
            </camel:from>
            <!-- you can also use other languages such as groovy, ognl, mvel, javascript etc. -->
            <camel:to id="c4e63689-785e-4541-a927-0e0cc98241c6" uri="https4://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(select%20woeid%20from%20geo.places(1)%20where%20text%3D%22nome%2C%20ak%22)&amp;format=json&amp;diagnostics=true&amp;env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&amp;callback=">
                <camel:description layoutX="200" layoutY="250" layoutWidth="120" layoutHeight="120"/>
            </camel:to>
            <camel:convertBodyTo type="java.lang.String" id="d97f9150-aab8-11e7-a0a5-1d4f80ae85b9">
                <camel:description layoutX="345" layoutY="250" layoutWidth="120" layoutHeight="120"/>
            </camel:convertBodyTo>
            <camel:to uri="bean:varpop?method=moveToOutboundVariables(&apos;_body_&apos;)" id="dde7ef60-a795-11e7-9c6e-b5575ac44e3c">
                <camel:description layoutX="480" layoutY="250" layoutWidth="120" layoutHeight="120"/>
            </camel:to>
        </camel:route>
    </camel:camelContext>
</beans>
```
There are several details to note in the code above.
-   The default namespace wrapper is spring, \<beans ...\>\</beans\>, and the Apache *camel:* tags must be namespaced between the spring tags.
-   The camel:description tags preserve the layout details for the flow editor, specifically the x,y positions of stencil icons used to define a flow in the designer. These tags are ignored during flow execution.
-   The camel:to uri setting uses http4 which is not a typographical error. In the Camel language, http4 is a language-specific syntax to refer to the Apache http4 client software. For other projects, use http4 or https4 as appropriate.
-   The returned data is converted to a string with the convertBodyTo setting.
-   The returned data output is sent to a Spring bean method moveToOutboundVariables to make the data available within a BPN process.
-   The *id* values are unique to the code block. Nothing outside of the integration flow design tool will refer to them. As with camel:description tags, id values are regenerated if deleted.
These Camel Components are currently included in the integration service:
-   Camel core components
-   HTTP4: <http://camel.apache.org/http4.html>
-   Email: <http://camel.apache.org/mail.html>
-   Ldap: <http://camel.apache.org/ldap.html>
-   Jdbc: <http://camel.apache.org/jdbc.html>   (mysql driver is present)
-   Printer: <http://camel.apache.org/printer.html>
-   Spring-ldap <http://camel.apache.org/spring-ldap.html>
-   FTP <http://camel.apache.org/ftp.html>
-   SMPP <http://camel.apache.org/smpp.html>
-   ServiceNow <http://camel.apache.org/servicenow.html>
Click the Designer View at the bottom right to display the code as stencil blocks. Reposition stencils and resize containers, if needed, to make the flow more understandable.
![](attachments/11939847/11939849.png)
Figure. Integration Flow Design for Yahoo Weather API
In this example, the *URL From* stencil at the top left flows to a *URL To* stencil which calls the Yahoo weather API. The stencil then flows to a *Body* stencil and a final *URL To* stencil which passes the API output a Spring integration that makes any data available to the BPN process that calls this integration flow.
To save the demonstration flow code, click the Folder icon at the top left of the Flows workspace to display the Save icon and flow details. Click the Save icon to save the flow.
# Deploy Integration Service
Once a flow and host are defined, click the Service Deploy tab near the top of the Integrations Home page. To create a deployment, click the plus sign near to top right of the workspace. The Integration Service Deployment popup appears. Select the Flow name and, as appropriate, the Hosts to Deploy in the popup. Click the Run button to deploy.
> [!warning]  
>
> The integration service only allows one flow code name – set when creating a flow – for all domains within an Amelia instance. Attempting to deploy an integration flow with a code name in one domain when it exists in another domain will generate an error. The error message will include a Confirm action check box in the Integration Service Deployment popup. Clicking the Confirm action check box will override the block, deploying two flows in one instance with the same name and possibly introducing errors.

![](attachments/11939847/11939848.png)
Figure. Integration Service Deployment Pop-Up
# Create a Flow with an Integration Template
Amelia’s ability to integrate with third party systems includes the creation and use of templates which can be used to create integration flows. Templates can reduce implementation time and errors.
Integration templates are part of the Integrations Home workspace found by clicking the Integrations link on the left side navigation of Amelia’s administration pages.
To create a template, click the Templates link at the top right of the Integrations Home workspace then click the plus (+) sign on the page that appears with a list of existing templates. The New Integration Template workspace appears.
![](attachments/11939847/11941843.png)
Figure. New Integration Template Workspace
Table. New Integration Template Workspace Elements

| Element | Description |
| ----|----|
| Name | Required. Type the name of the integration template. |
| Flow Context | Required. Type or copy/paste Camel code used for integration. |
| Description | Required. Type a short description of the purpose of the template. |
| Assets | Select any pre-existing assets. |
| Upload Icon | Click the Add New button to upload an icon to represent the template. Icons must be in PNG, JPG, or JPEG format and less than 2MB in file size. |
| Flow Properties | Click the heading to display options. Click the plus (+) icon to create a new flow property and specify the Property Name and a Description. |
| Runtime Input Variables | Click the heading to display options. Click the plus (+) icon to create new runtime input variables and specify the Property Name and a Description. |
| Runtime Output Variables | Click the heading to display options. Click the plus (+) icon to create new runtime output variables and specify the Property Name and a Description. |

To create an integration flow from an existing template, from the Templates workspace click the stacked three dots at the top right of a template list and select Create Flow from the popup.
![](attachments/11939847/11941844.png)
Figure. Create Flow from Existing Template
The Create Flow from Template popup ppears. Type a unique Code for the flow, edit the Name to create a unique flow name, and select a Domain. Click Create and Edit to save the new flow then display the Edit Integration Flow workspace with data from the integration template.
![](attachments/11939847/11941845.png)
Figure. Create Flow from Template Popup
# Create an Integration Template from an Integration Flow
Integration flows also can be converted to templates. In the Flow editor, click the Save icon to display a dropdown list. Select the Save as Template option. Flow data will appear in a New Integration Template form with some values pre-filled. Type in Name and enter other data to complete the template.
![](attachments/11939847/11941859.png)
Figure. Save as Template Dropdown
{% /version %}
